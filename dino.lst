mads 2.1.7 build 3 (13 Sep 23)
Source: dino.asm
     1 = 0008			SCR_HEIGHT = 8
     2 = 0040			WORLD_LENGTH = 64
     3 = 0010			DIFF_LEVELS = 16
     4
     5 				;  No internet
     6 				;---------------------------------------------------
     7 				    OPT r+
     8
     9 				;---------------------------------------------------
    10 				; Zpage variables
    11 				    .zpvar temp_w   .word = $80
    12 				    .zpvar temp_b   .byte
    13 				    .zpvar DinoWalkPhase    .byte
    14 				    .zpvar DinoState    .byte   ; 0/1 - walk, 2/3 - crouch, 4... - jump 
    15 				    .zpvar JumpPhase    .byte
    16 				;---------------------------------------------------
    17 				    icl 'lib/ATARISYS.ASM'
Source: ATARISYS.ASM
     1 				;****************************************************************************
     2 				;*                         ATARI PERSONAL COMPUTER                          *
     3 				;*                              SYSTEM EQUATES                              *
     4 				;****************************************************************************
     5 				;
     6 				; OPERATING SYSTEM EQUATE FILE
     7 				;
     8 				; MODULE ORIGIN TABLE
     9 				;
    10 				; VECTOR TABLE
    11 				;
    12 				; HANDLER ENTRY POINTS ARE CALL-
    13 				; ED OUT IN THE FOLLOWING VECTOR
    14 				; TABLE. THESE ARE THE ADDRESSES
    15 				; MINUS ONE.
    16 				;
    17 				; EXAMPLE FOR EDITOR
    18 				;
    19 				; E400     OPEN
    20 				;    2     CLOSE
    21 				;    4     GET
    22 				;    6     PUT
    23 				;    8     STATUS
    24 				;    A     SPECIAL
    25 				;    C     JUMP TO POWER ON INIT
    26 				;    F     NOT USED
    27 				;
    28 = E400			EDITRV	EQU	$E400	;EDITOR
    29 = E410			SCRENV	EQU	$E410	;TV SCREEN
    30 = E420			KEYBDV	EQU	$E420	;KEYBOARD
    31 = E430			PRINTV	EQU	$E430	;PRINTER
    32 = E440			CASETV	EQU	$E440	;CASSETTE
    33 				;
    34 				; JUMP VECTOR TABLE
    35 				;
    36 				; THE FOLLOWING IS A TABLE OF
    37 				; JUMP INSTRUCTIONS TO VARIOUS
    38 				; ENTRY POINTS IN THE OPERATING
    39 				; SYSTEM
    40 				;
    41 = E450			DISKIV	EQU	$E450	;DISK INITIALIZATION
    42 = E453			DSKINV	EQU	$E453	;DISK INTERFACE
    43 = E456			CIOV  	EQU	$E456	;CENTRAL I/O ROUTINE
    44 = E459			SIOV  	EQU	$E459	;SERIAL I/O ROUTINE
    45 = E45C			SETVBV	EQU	$E45C	;SET SYSTEM TIMERS
    46 = E45F			SYSVBV	EQU	$E45F	;VBLANK CALCULATIONS
    47 = E462			XITVBV	EQU	$E462	;EXIT VBLANK
    48 = E465			SIOINV	EQU	$E465	;SIO INITIALIZATION
    49 = E468			SENDEV	EQU	$E468	;SEND ENABLE ROUTINE
    50 = E46B			INTINV	EQU	$E46B	;INTRPT HANDLER INIT
    51 = E46E			CIOINV	EQU	$E46E	;CIO INITIALIZATION
    52 = E471			BLKBDV	EQU	$E471	;BLACKBOARD MODE
    53 = E474			WARMSV	EQU	$E474	;WARM START VECTOR
    54 = E477			COLDSV	EQU	$E477	;COLD START VECTOR
    55 = E47A			RBLOKV	EQU	$E47A	;CASSETTE READ BLOCK
    56 = E47D			CSOPIV	EQU	$E47D	;CASSETTE INPUT OPEN
    57 				;
    58 				; VECTORS ADDED FOR 800XL
    59 				;
    60 = E480			PUPDIV	EQU	$E480	;POWER UP DISPLAY
    61 = E483			SLFTSV	EQU	$E483	;SELF TEST PROGRAM
    62 = E486			PHENTV	EQU	$E486	;UPLOADED HANDLER ENTER
    63 = E489			PHULNV	EQU	$E489	;UPLOADED HANDLER UNLINK
    64 = E48C			PHINIV	EQU	$E48C	;UPLOADED HANDLER INIT
    65 				;
    66 				; OPERATING SYSTEM EQUATES
    67 				;
    68 				; COMMAND CODES FOR IOCBS
    69 				;
    70 = 0003			_OPEN  	EQU	$03	;OPEN FOR I/O
    71 = 0005			GETREC	EQU	$05	;GET RECORD (TEXT)
    72 = 0007			GETCHR	EQU	$07	;GET CHARACTER(S)
    73 = 0009			PUTREC	EQU	$09	;PUT RECORD (TEXT)
    74 = 000B			PUTCHR	EQU	$0B	;PUT CHARACTER(S)
    75 = 000C			_CLOSE 	EQU	$0C	;CLOSE DEVICE
    76 = 000D			STATIS	EQU	$0D	;STATUS REQUEST
    77 = 000E			SPECIL	EQU	$0E	;SPECIAL ENTRY COMMAND
    78 				;
    79 				; SPECIAL ENTRY COMMANDS
    80 				;
    81 = 0011			DRAWLN	EQU	$11	;DRAW LINE
    82 = 0012			FILLIN	EQU	$12	;FILL
    83 = 0020			RENAME	EQU	$20	;RENAME DISK FILE
    84 = 0021			DELETE	EQU	$21	;DELETE DISK FILE
    85 = 0022			FORMAT	EQU	$22	;FORMAT DISK
    86 = 0023			LOCKFL	EQU	$23	;LOCK FILE
    87 = 0024			UNLOCK	EQU	$24	;UNLOCK FILE
    88 = 0025			POINT 	EQU	$25	;POINT SECTOR
    89 = 0026			NOTE  	EQU	$26	;NOTE SECTOR
    90 = 00FF			IOCFRE	EQU	$FF	;IOCB "FREE"
    91 				;
    92 				; AUX1 EQUATES
    93 				; () INDICATES WHICH DEVICES
    94 				;
    95 = 0001			APPEND	EQU	$01	;WR APPEND(D)-SCN RD(E)
    96 = 0002			DIRECT	EQU	$02	;OPEN DIRECTORY(D)
    97 = 0004			OPNIN 	EQU	$04	;OPEN FOR INPUT(ALL)
    98 = 0008			OPNOT 	EQU	$08	;OPEN FOR OUTPUT(ALL)
    99 = 000C			OPNINO	EQU	$0C	;OPEN INPUT&OUTPUT(ALL)
   100 = 0010			MXDMOD	EQU	$10	;OPEN MIXED MODE(E,S)
   101 = 0020			INSCLR	EQU	$20	;OPEN W/O CLEAR(E,S)
   102 				;
   103 				; DEVICE NAMES
   104 				;
   105 = 0045			SCREDT	EQU	'E'	;SCREEN EDITOR (R/W)
   106 = 004B			KBD   	EQU	'K'	;KEYBOARD (R ONLY)
   107 = 0053			DISPLY	EQU	'S'	;SCREEN DISPLAY (R/W)
   108 = 0050			PRINTR	EQU	'P'	;PRINTER (W ONLY)
   109 = 0043			CASSET	EQU	'C'	;CASSETTE (R/W)
   110 = 0052			RS232 	EQU	'R'	;MODEM (R/W)
   111 = 0044			DISK  	EQU	'D'	;DISK (R/W)
   112 				;
   113 				;
   114 				;
   115 				; OPERATING SYSTEM STATUS CODES
   116 				;
   117 = 0001			SUCCES	EQU	$01	;SUCCESSFUL OPERATION
   118 = 0080			BRKABT	EQU	$80	;BREAK KEY ABORT
   119 = 0081			PRVOPN	EQU	$81	;IOCB ALREADY OPEN
   120 = 0082			NONDEV	EQU	$82	;NON-EXISTANT DEVICE
   121 = 0083			WRONLY	EQU	$83	;IOCB OPEN FOR W ONLY
   122 = 0084			NVALID	EQU	$84	;INVALID COMMAND
   123 = 0085			NOTOPN	EQU	$85	;DEVICE/FILE NOT OPEN
   124 = 0086			BADIOC	EQU	$86	;INVALID IOCB #
   125 = 0087			RDONLY	EQU	$87	;IOCB OPEN FOR R ONLY
   126 = 0088			EOFERR	EQU	$88	;END OF FILE
   127 = 0089			TRNRCD	EQU	$89	;TRUNCATED RECORD
   128 = 008A			TIMOUT	EQU	$8A	;PERIPHERAL TIMEOUT
   129 = 008B			DNACK 	EQU	$8B	;DEVICE NO ACKNOWLEDGE
   130 = 008C			FRMERR	EQU	$8C	;SERIAL BUS FRAME ERR
   131 = 008D			CRSROR	EQU	$8D	;CURSOR OVERRANGE
   132 = 008E			OVRRUN	EQU	$8E	;SERIAL DATA OVERRUN
   133 = 008F			CHKERR	EQU	$8F	;SERIAL CHECKSUM ERR
   134 = 0090			DERRER	EQU	$90	;PERIPHRAL DEVICE ERR
   135 = 0091			BADMOD	EQU	$91	;BAD SCREEN MODE #
   136 = 0092			FNCNOT	EQU	$92	;NONEXISTANT FUNCTION
   137 = 0093			SCRMEM	EQU	$93	;SCREEN MEM TOO SMALL
   138 = 00AA			FILENF  EQU $AA ;FILE NOT FOUND
   139 				;
   140 				; PAGE ZERO RAM ASSIGNMENTS
   141 				;
   142 = 0000			LNFLG 	EQU	$00	;LINBUG RAM
   143 = 0001			NGFLAG	EQU	$01	;POWER-UP SELF-TEST FLAG
   144 				;
   145 				; THESE LOCATIONS NOT CLEARED
   146 				;
   147 = 0002			CASINI	EQU	$02	;CASSETTE INIT LOC
   148 = 0004			RAMLO 	EQU	$04	;RAM POINTER MEM TST
   149 = 0006			TRAMSZ	EQU	$06	;TEMP REG RAM SIZE
   150 = 0007			TSTDAT	EQU	$07	;RAM TEST DATA REG
   151 				;
   152 				;CLEARED ON COLDSTART ONLY
   153 				;
   154 = 0008			WARMST	EQU	$08	;WARM START FLAG
   155 = 0009			BOOTQ 	EQU	$09	;SUCCESSFUL BOOT FLG
   156 = 000A			DOSVEC	EQU	$0A	;DOS START VECTOR
   157 = 000C			DOSINI	EQU	$0C	;DOS INIT ADDRESS
   158 = 000E			APPMHI	EQU	$0E	;APPL MEM HI LIMIT
   159 				;
   160 				;CLEARED ON COLD OR WARM START
   161 				;
   162 = 0010			POKMSK	EQU	$10	;MASK POKEY IRQ
   163 = 0011			BRKKEY	EQU	$11	;BREAK KEY FLAG
   164 = 0012			RTCLOK	EQU	$12	;REAL TIME CLOCK
   165 = 0015			BUFADR	EQU	$15	;INDIRECT BUFF ADDR
   166 = 0017			ICCOMT	EQU	$17	;COMMAND FOR VECTOR
   167 = 0018			DSKFMS	EQU	$18	;FMS POINTER
   168 = 001A			DSKUTL	EQU	$1A	;DISK UTILITIES PTR
   169 = 001C			ABUFPT	EQU	$1C	;RESERVED
   170 = 0020			ICHIDZ	EQU	$20	;HANDLER INDEX #
   171 = 0021			ICDNOZ	EQU	$21	;DEVICE NUMBER
   172 = 0022			ICCOMZ	EQU	$22	;COMMAND CODE
   173 = 0023			ICSTAZ	EQU	$23	;STATUS RETURN
   174 = 0024			ICBALZ	EQU	$24	;BUFFER ADDRESS
   175 = 0025			ICBAHZ	EQU	$25
   176 = 0026			ICPTLZ	EQU	$26	;PUT BYTE ROUTINE-1
   177 = 0027			ICPTHZ	EQU	$27
   178 = 0028			ICBLLZ	EQU	$28	;BUFFER LENGTH
   179 = 0029			ICBLHZ	EQU	$29
   180 = 002A			ICAX1Z	EQU	$2A	;AUXILIARY BYTES
   181 = 002B			ICAX2Z	EQU	$2B
   182 = 002C			ICSPRZ	EQU	$2C	;SPARE BYTES
   183 = 002E			ICIDNO	EQU	$2E	;IOCB # X 16
   184 = 002F			CIOCHR	EQU	$2F	;CIO CHARACTER BYTE
   185 = 0030			STATUS	EQU	$30	;INTERNAL STATUS
   186 = 0031			CHKSUM	EQU	$31	;CHECKSUM
   187 = 0032			BUFRLO	EQU	$32	;DATA BUFFER LO BYTE
   188 = 0033			BUFRHI	EQU	$33	;DATA BUFFER HI BYTE
   189 = 0034			BFENLO	EQU	$34	;NEXT BYTE PAST DATA
   190 = 0035			BFENHI	EQU	$35	;BUFFER (HI & LO)
   191 = 0036			LTEMP 	EQU	$36	;LOADER TEMP
   192 = 0038			BUFRFL	EQU	$38	;DATA BUFFR FULL FLG
   193 = 0039			RECVDN	EQU	$39	;RECIEVE DONE FLAG
   194 = 003A			XMTDON	EQU	$3A	;XMIT DONE FLAG
   195 = 003B			CHKSNT	EQU	$3B	;CHECKSUM SENT FLAG
   196 = 003C			NOCKSM	EQU	$3C	;NO CHKSUM SENT FLAG
   197 				;BPTR  	EQU	$3D	;CASSETTE DATA INDEX
   198 = 003E			FTYPE 	EQU	$3E	;INTERRECORD GAP TYPE
   199 = 003F			FEOF  	EQU	$3F	;END OF FILE FLAG
   200 = 0040			FREQ  	EQU	$40	;BEEP COUNT
   201 = 0041			SOUNDR	EQU	$41	;NOISY I/O FLAG
   202 = 0042			CRITIC	EQU	$42	;CRITICAL MODE
   203 = 0043			FMSZPG	EQU	$43	;FMS ZERO PAGE
   204 = 004A			ZCHAIN	EQU	$4A	;HANDLER LOADER TEMP
   205 = 004C			DSTAT 	EQU	$4C	;DISPLAY STATUS
   206 = 004D			ATRACT	EQU	$4D	;ATTRACT FLAG
   207 = 004E			DRKMSK	EQU	$4E	;DARK ATTRACT MASK
   208 = 004F			COLRSH	EQU	$4F	;COLOR SHIFTER
   209 = 0050			TMPCHR	EQU	$50	;TEMP STORAGE
   210 = 0051			HOLD1 	EQU	$51	;TEMP STORAGE
   211 = 0052			LMARGN	EQU	$52	;LEFT MARGIN (1)
   212 = 0053			RMARGN	EQU	$53	;RIGHT MARGIN (38)
   213 = 0054			ROWCRS	EQU	$54	;CURSOR COUNTERS
   214 = 0055			COLCRS	EQU	$55
   215 = 0057			DINDEX	EQU	$57	;DISPLAY MODE #
   216 = 0058			SAVMSC	EQU	$58	;SCREEN MEM ADDR
   217 = 005A			OLDROW	EQU	$5A	;DRAW START POSIT
   218 = 005B			OLDCOL	EQU	$5B
   219 = 005D			OLDCHR	EQU	$5D	;DATA UNDER CURSOR
   220 = 005E			OLDADR	EQU	$5E	;CURSOR MEM ADDR
   221 = 0060			FKDEF 	EQU	$60	;FUNC KEY DEFEAT POINTER
   222 = 0062			PALNTS	EQU	$62	;PAL/NTSC FLAG
   223 = 0063			LOGCOL	EQU	$63	;COL IN LOGICAL LINE
   224 = 0064			ADRESS	EQU	$64	;TEMP STORAGE
   225 = 0066			MLTEMP	EQU	$66	;TEMP STORAGE
   226 = 0068			SAVADR	EQU	$68	;TEMP STORAGE
   227 = 006A			RAMTOP	EQU	$6A	;AVAILABLE RAM PAGES
   228 = 006B			BUFCNT	EQU	$6B	;BUFFER COUNT
   229 = 006C			BUFSTR	EQU	$6C	;EDITOR GETCH POINTR
   230 = 006E			BITMSK	EQU	$6E	;BIT MASK
   231 = 006F			SHFAMT	EQU	$6F	;PIXEL JUSTIFICATION
   232 = 0070			ROWAC 	EQU	$70	;ROW ACCUMULATOR
   233 = 0072			COLAC 	EQU	$72	;COLUMN ACCUMULATOR
   234 = 0074			ENDPT 	EQU	$74	;LINE LENGTH
   235 = 0076			DELTAR	EQU	$76	;DELTA ROW
   236 = 0077			DELTAC	EQU	$77	;DELTA COLUMN
   237 = 0079			KEYDEF	EQU	$79	;KEY DEFEAT POINTER
   238 = 007B			SWPFLG	EQU	$7B	;SPLIT SCN CURS CNTL
   239 = 007C			HOLDCH	EQU	$7C	;KB CHAR TEMP HOLD
   240 = 007D			INSDAT	EQU	$7D	;TEMP STORAGE
   241 = 007E			COUNTR	EQU	$7E	;DRAW ITERATION CNT
   242 				;
   243 				; 80-FF ARE RESERVED FOR USER
   244 				;
   245 				; NOTE: SEE FLOATING POINT
   246 				; SUBROUTINE AREA FOR ZERO
   247 				; PAGE CELLS
   248 				;
   249 				; PAGE 1 - HARDWARE STACK
   250 				;
   251 				; PAGE TWO RAM ASSIGNMENTS
   252 				;
   253 = 0200			VDSLST	EQU	$0200	;DSP LIST NMI VECTOR
   254 = 0202			VPRCED	EQU	$0202	;PROCEED IRQ VECTOR
   255 = 0204			VINTER	EQU	$0204	;INTERUPT IRQ VECTOR
   256 = 0206			VBREAK	EQU	$0206	;BRK INST IRQ VECTOR
   257 = 0208			VKEYBD	EQU	$0208	;POKEY KB IRQ VECTOR
   258 = 020A			VSERIN	EQU	$020A	;POKEY INPUT RDY IRQ
   259 = 020C			VSEROR	EQU	$020C	;POKEY OUTPUT RDY
   260 = 020E			VSEROC	EQU	$020E	;POKEY OUTPUT DONE
   261 = 0210			VTIMR1	EQU	$0210	;POKEY TIMER 1 IRQ
   262 = 0212			VTIMR2	EQU	$0212	;POKEY TIMER 2 IRQ
   263 = 0214			VTIMR4	EQU	$0214	;POKEY TIMER 4 IRQ
   264 = 0216			VIMIRQ	EQU	$0216	;IMMED IRQ VECTOR
   265 = 0218			CDTMV1	EQU	$0218	;COUNT DOWN TIMER 1
   266 = 021A			CDTMV2	EQU	$021A	;COUNT DOWN TIMER 2
   267 = 021C			CDTMV3	EQU	$021C	;COUNT DOWN TIMER 3
   268 = 021E			CDTMV4	EQU	$021E	;COUNT DOWN TIMER 4
   269 = 0220			CDTMV5	EQU	$0220	;COUNT DOWN TIMER 5
   270 = 0222			VVBLKI	EQU	$0222	;IMM VBLK NMI VECTOR
   271 = 0224			VVBLKD	EQU	$0224	;DEF VBLK NMI VECTOR
   272 = 0226			CDTMA1	EQU	$0226	;CDTMV1 JSR ADDRESS
   273 = 0228			CDTMA2	EQU	$0228	;CDTMV2 JSR ADDRESS
   274 = 022A			CDTMF3	EQU	$022A	;CDTMV3 FLAG
   275 = 022B			SRTIMR	EQU	$022B	;SOFTWARE REPEAT TMR
   276 = 022C			CDTMF4	EQU	$022C	;CDTMV4 FLAG
   277 = 022D			INTEMP	EQU	$022D	;IAN'S TEMP
   278 = 022E			CDTMF5	EQU	$022E	;CDTMV5 FLAG
   279 = 022F			DMACTLS	EQU	$022F	;SAVE DMACTL REG
   280 = 0230			DLPTRS	EQU	$0230	;SAVE DISP LIST LO
   281 				;SDLSTH	EQU	$0231	;SAVE DISP LIST HI
   282 = 0232			SSKCTL	EQU	$0232	;SKCTL REGISTER RAM
   283 = 0233			LCOUNT	EQU	$0233	;LOADER TEMP
   284 = 0234			LPENH 	EQU	$0234	;LIGHT PEN HORIZONTAL
   285 = 0235			LPENV 	EQU	$0235	;LIGHT PEN VERTICAL
   286 = 0236			BRKKY 	EQU	$0236	;BREAK KEY VECTOR
   287 = 0238			RELADR	EQU	$0238	;LOADER REL ADDR
   288 = 023A			CDEVIC	EQU	$023A	;COMMAND BUFFER-DEV
   289 = 023B			CCOMND	EQU	$023B	;COMMAND BUFFER-CMND
   290 = 023C			CAUX1 	EQU	$023C	;COMMAND BUFFER AUX1
   291 = 023D			CAUX2 	EQU	$023D	;COMMAND BUFFER AUX2
   292 				;TEMP  	EQU	$023E	;TEMPORARY RAM CELL
   293 = 023F			ERRFLG	EQU	$023F	;DEVICE ERROR FLAG
   294 = 0240			DFLAGS	EQU	$0240	;DISK FLAGS(SECTOR1)
   295 = 0241			DBSECT	EQU	$0241	;# DISK BOOT SECTORS
   296 = 0242			BOOTAD	EQU	$0242	;DISK BOOT ADDRESS
   297 = 0244			COLDST	EQU	$0244	;COLDSTART FLAG 1=CS
   298 = 0245			RECLEN	EQU	$0245	;LOADER LENGTH
   299 = 0246			DSKTIM	EQU	$0246	;DISK TIME OUT REG
   300 = 026C			VSFLAG	EQU	$026C	;FINE SCROLL TEMP
   301 = 026D			KEYDIS	EQU	$026D	;KEY DISABLE FLAG
   302 = 026E			FINE  	EQU	$026E	;FINE SCROLL ENABLE(A1200)
   303 = 026F			GPRIOR	EQU	$026F	;GLOBAL PRIORITY
   304 = 0270			PADDL0	EQU	$0270	;POT 0 RAM CELL
   305 = 0271			PADDL1	EQU	$0271
   306 = 0272			PADDL2	EQU	$0272
   307 = 0273			PADDL3	EQU	$0273
   308 = 0278			STICK0	EQU	$0278	;JOYSTICK 0 RAM CELL
   309 = 0279			STICK1	EQU	$0279
   310 = 027C			PTRIG0	EQU	$027C	;PADDLE TRIGGER 0
   311 = 027D			PTRIG1	EQU	$027D
   312 = 027E			PTRIG2	EQU	$027E
   313 = 027F			PTRIG3	EQU	$027F
   314 = 0284			STRIG0	EQU	$0284	;JOYSTICK TRIGGER 0
   315 = 0285			STRIG1	EQU	$0285
   316 = 0288			HIBYTE	EQU	$0288	;LOADER
   317 = 0289			WMODE 	EQU	$0289	;CASSETTE R/W MODE
   318 = 028A			BLIM  	EQU	$028A	;CASSETTE RECORD SIZE
   319 = 028B			IMASK 	EQU	$028B
   320 = 028C			JVECK 	EQU	$028C	;JUMP VECTOR
   321 = 028E			NEWADR	EQU	$028E	;LOADER NEW ADDRESS
   322 = 0290			TXTROW	EQU	$0290	;TEXT ROWCRS
   323 = 0291			TXTCOL	EQU	$0291	;TEXT COLCRS
   324 = 0293			TINDEX	EQU	$0293	;TEXT INDEX
   325 = 0294			TXTMSC	EQU	$0294	;TEXT WINDOW MEM ADD
   326 = 0296			TXTOLD	EQU	$0296	;TEXT OLDROW & COL
   327 = 029C			CRETRY	EQU	$029C	;# COMMAND RETRIES
   328 = 029D			HOLD3 	EQU	$029D
   329 = 029E			SUBTMP	EQU	$029E
   330 = 029F			HOLD2 	EQU	$029F
   331 = 02A0			DMASK 	EQU	$02A0	;PIXEL LOCATION MASK
   332 = 02A1			TMPLBT	EQU	$02A1
   333 = 02A2			ESCFLG	EQU	$02A2	;ESCAPE FLAG
   334 = 02A3			TABMAP	EQU	$02A3	;TAB STOP MAP
   335 = 02B2			LOGMAP	EQU	$02B2 	;LINE START BIT MAP
   336 = 02B6			INVFLG	EQU	$02B6	;INVERSE VIDEO FLAG
   337 = 02B7			FILFLG	EQU	$02B7	;FILL FLAG FOR DRAW
   338 = 02B8			TMPROW	EQU	$02B8
   339 = 02B9			TMPCOL	EQU	$02B9
   340 = 02BB			SCRFLG	EQU	$02BB	;SET IF SCROLLING
   341 = 02BC			HOLD4 	EQU	$02BC	;TEMP USED BY DRAW
   342 = 02BD			DRETRY	EQU	$02BD	;# OF DEVICE RETRIES
   343 = 02BE			SHFLOK	EQU	$02BE	;SHIFT/CTL LOCK FLAG
   344 = 02BF			BOTSCR	EQU	$02BF	;BOTTOM OF SCREEN
   345 = 02C0			PCOLR0	EQU	$02C0	;P0 COLOR
   346 = 02C1			PCOLR1	EQU	$02C1	;P1 COLOR
   347 = 02C2			PCOLR2	EQU	$02C2	;P2 COLOR
   348 = 02C3			PCOLR3	EQU	$02C3	;P3 COLOR
   349 = 02C4			COLOR0	EQU	$02C4	;COLOR 0
   350 = 02C5			COLOR1	EQU	$02C5
   351 = 02C6			COLOR2	EQU	$02C6
   352 = 02C7			COLOR3	EQU	$02C7
   353 = 02C8			COLOR4	EQU	$02C8
   354 = 02C8			COLBAKS EQU COLOR4
   355 = 02C9			RUNADR	EQU	$02C9	;LOADER
   356 = 02CB			HIUSED	EQU	$02CB	;LOADER
   357 = 02CD			ZHIUSE	EQU	$02CD	;LOADER
   358 = 02CF			GBYTEA	EQU	$02CF	;LOADER
   359 = 02D1			LOADAD	EQU	$02D1	;LOADER
   360 = 02D3			ZLOADA	EQU	$02D3	;LOADER
   361 = 02D5			DSCTLN	EQU	$02D5	;DISK SECTOR LENGTH
   362 = 02D7			ACMISR	EQU	$02D7	;RESERVED
   363 = 02D9			KRPDEL	EQU	$02D9	;KEY REPEAT DELAY
   364 = 02DA			KEYREP	EQU	$02DA	;KEY REPEAT RATE(VBLANKS)
   365 = 02DB			NOCLIK	EQU	$02DB	;CLICK ENABLE/DISABLE
   366 = 02DC			HELPFG	EQU	$02DC	;HELP KEY FLAG
   367 = 02DD			DMASAV	EQU	$02DD	;DMA SAVE STATE
   368 = 02DE			PBPNT 	EQU	$02DE	;PRINT BUFFER POINTER
   369 = 02DF			PBUFSZ	EQU	$02DF	;PRINT BUFFER SIZE
   370 = 02E0			DOSRUN	EQU	$02E0	;DOS RUN/INIT ADDRESSES
   371 = 02E4			RAMSIZ	EQU	$02E4	;RAM SIZE-HIGH BYTE
   372 = 02E5			MEMTOP	EQU	$02E5	;TOP OF AVAIL MEMORY
   373 = 02E7			MEMLO 	EQU	$02E7	;BOTTOM OF AVAIL MEM
   374 = 02E9			HNDLOD	EQU	$02E9	;POLL FLAG (1200)
   375 = 02EA			DVSTAT	EQU	$02EA	;STATUS BUFFER
   376 = 02EE			CBAUDL	EQU	$02EE	;CASSETTE BAUD RATE
   377 = 02EF			CBAUDH	EQU	$02EF
   378 = 02F0			CRSINH	EQU	$02F0	;CURSOR INHIBIT 0=ON
   379 = 02F1			KEYDEL	EQU	$02F1	;KEY DELAY
   380 = 02F2			CH1	    EQU	$02F2	;PRIOR KB CHAR CODE
   381 = 02F3			CHACT 	EQU	$02F3	;CHACTL REGISTER RAM
   382 = 02F4			CHBAS 	EQU	$02F4	;CHBAS REGISTER RAM
   383 = 02F5			NEWROW	EQU	$02F5	;POINT DRAW GOES TO
   384 = 02F6			NEWCOL	EQU	$02F6
   385 = 02F8			ROWINC	EQU	$02F8	;ROW INCREMENT VALUE
   386 = 02F9			COLINC	EQU	$02F9	;COL INCREMENT VALUE
   387 = 02FA			CHAR  	EQU	$02FA	;INTERNAL CHAR CODE
   388 = 02FB			ATACHR	EQU	$02FB	;ATASCII CHARACTER
   389 = 02FC			CHKEY  	EQU	$02FC	;KB CHAR CODE (FIFO)
   390 = 02FD			FILDAT	EQU	$02FD	;RIGHT FILL DATA
   391 = 02FE			DSPFLG	EQU	$02FE	;DISPLAY FLAG
   392 = 02FF			SSFLAG	EQU	$02FF	;START/STOP FLAG
   393 				;
   394 				; PAGE THREE RAM ASSIGNMENTS
   395 				;
   396 = 0300			DDEVIC	EQU	$0300	;BUS I.D. NUMBER
   397 = 0301			DUNIT 	EQU	$0301	;UNIT NUMBER
   398 = 0302			DCOMND	EQU	$0302	;BUS COMMAND
   399 = 0303			DSTATS	EQU	$0303	;COMMAND TYPE/STATUS
   400 = 0304			DBUFLO	EQU	$0304	;DATA BUFFER LO BYTE
   401 = 0305			DBUFHI	EQU	$0305	;DATA BUFFER HI BYTE
   402 = 0306			DTIMLO	EQU	$0306	;DEVICE TIMEOUT SECS
   403 = 0307			DUNUSE	EQU	$0307	;UNUSED BYTE
   404 = 0308			DBYTLO	EQU	$0308	;# OF BYTES XFERRED
   405 = 0309			DBYTHI	EQU	$0309
   406 = 030A			DAUX1 	EQU	$030A	;COMMAND AUX BYTE 1
   407 = 030B			DAUX2 	EQU	$030B	;COMMAND AUX BYTE 2
   408 = 030C			TIMER1	EQU	$030C	;INITIAL TIMER VALUE
   409 = 030E			JMPERS	EQU	$030E	;OPTIONS (1200)
   410 = 030F			CASFLG	EQU	$030F	;CASSETE MODE IF SET
   411 = 0310			TIMER2	EQU	$0310	;FINAL TIMER VALUE
   412 				;TEMP1 	EQU	$0312	;TEMP STORAGE
   413 				;TEMP2 	EQU	$0313	;TEMP STORAGE
   414 = 0314			PTIMOT	EQU	$0314	;PRINTER TIMEOUT REG
   415 				;TEMP3 	EQU	$0315	;TEMP STORAGE
   416 = 0316			SAVIO 	EQU	$0316	;SAVE SERIAL IN DATA
   417 = 0317			TIMFLG	EQU	$0317	;TIMEOUT FLAG C BAUD
   418 = 0318			STACKP	EQU	$0318	;SIO STACK PTR SAVE
   419 = 0319			TSTAT 	EQU	$0319	;TEMP STATUS HOLDER
   420 = 031A			HATABS	EQU	$031A	;HANDLER ADDR TABLE
   421 = 033D			PUPBT1	EQU	$033D	;POWER/UP RESET
   422 = 033E			PUPBT2	EQU	$033E
   423 = 033F			PUPBT3	EQU	$033F
   424 = 0340			ICHID 	EQU	$0340	;HANDLER INDEX #
   425 = 0341			ICDNO 	EQU	$0341	;DEVICE NUMBER
   426 = 0342			ICCOM 	EQU	$0342	;COMMAND CODE
   427 = 0343			ICSTA 	EQU	$0343	;STATUS
   428 = 0344			ICBAL 	EQU	$0344	;BUFFER ADDR LO BYTE
   429 = 0345			ICBAH 	EQU	$0345	;BUFFER ADDR HI BYTE
   430 = 0346			ICPTL 	EQU	$0346	;PUT ROUTINE ADDR-1
   431 = 0347			ICPTH 	EQU	$0347
   432 = 0348			ICBLL 	EQU	$0348	;BUFFER LENGTH LO
   433 = 0349			ICBLH 	EQU	$0349	;BUFFER LENGTH HI
   434 = 034A			ICAX1 	EQU	$034A	;AUX BYTE 1
   435 = 034B			ICAX2 	EQU	$034B	;AUX BYTE 2
   436 = 034C			ICSPR 	EQU	$034C 	;SPARE BYTES
   437 = 03C0			PRNBUF	EQU	$03C0	;PRINTER BUFFER (40 BYTES)
   438 = 03E8			SUPERF	EQU	$03E8	;SCREEN EDITOR
   439 = 03E9			CKEY  	EQU	$03E9	;START KEY FLAG
   440 = 03EA			CASSBT	EQU	$03EA	;CASSETTE BOOT FLAG
   441 = 03EB			CARTCK	EQU	$03EB	;CARTRIDGE CHECKSUM
   442 = 03ED			ACMVAR	EQU	$03ED	;RESERVED
   443 = 03F9			MINTLK	EQU	$03F9	;RESERVED
   444 = 03FA			GINTLK	EQU	$03FA	;CART INTERLOCK
   445 = 03FB			CHLINK	EQU	$03FB	;HANDLER CHAIN
   446 				;
   447 				; PAGE FOUR RAM ASSIGNMENTS
   448 				;
   449 = 03FD			CASBUF	EQU	$03FD	;CASSETTE BUFFER (131 BYTES)
   450 = 0480			USAREA	EQU	$0480	;USER AREA
   451 				;
   452 				; PAGE FIVE AND SIX ARE RESERVED
   453 				; FOR USER WORK SPACE
   454 				;
   455 				;    COLLEEN MNEMONICS
   456 				;
   457 				; ---------------------------------------------------------------------------
   458 = D200			POKEY 	EQU	$D200
   459 				; ---------------------------------------------------------------------------
   460 				;
   461 				; READ
   462 				;
   463 = D200			POT0  	EQU	POKEY+$00
   464 = D201			POT1  	EQU	POKEY+$01
   465 = D202			POT2  	EQU	POKEY+$02
   466 = D203			POT3  	EQU	POKEY+$03
   467 = D204			POT4  	EQU	POKEY+$04
   468 = D205			POT5  	EQU	POKEY+$05
   469 = D206			POT6  	EQU	POKEY+$06
   470 = D207			POT7  	EQU	POKEY+$07
   471 = D208			ALLPOT	EQU	POKEY+$08
   472 = D209			KBCODE	EQU	POKEY+$09
   473 = D20A			RANDOM	EQU	POKEY+$0a
   474 = D20B			POTGO 	EQU	POKEY+$0b
   475 = D20D			SERIN 	EQU	POKEY+$0d
   476 = D20E			IRQST 	EQU	POKEY+$0e
   477 = D20F			SKSTAT	EQU	POKEY+$0f
   478 				;
   479 				; WRITE
   480 				;
   481 = D200			AUDF1 	EQU	POKEY+$00
   482 = D201			AUDC1 	EQU	POKEY+$01
   483 = D202			AUDF2 	EQU	POKEY+$02
   484 = D203			AUDC2 	EQU	POKEY+$03
   485 = D204			AUDF3 	EQU	POKEY+$04
   486 = D205			AUDC3 	EQU	POKEY+$05
   487 = D206			AUDF4 	EQU	POKEY+$06
   488 = D207			AUDC4 	EQU	POKEY+$07
   489 = D208			AUDCTL	EQU	POKEY+$08
   490 = D209			STIMER	EQU	POKEY+$09
   491 = D20A			SKRES 	EQU	POKEY+$0a
   492 = D20D			SEROUT	EQU	POKEY+$0d
   493 = D20E			IRQEN 	EQU	POKEY+$0e
   494 = D20F			SKCTL 	EQU	POKEY+$0f
   495 				;
   496 				;
   497 				;
   498 				; ---------------------------------------------------------------------------
   499 = D000			GTIA  	EQU	$D000
   500 				; ---------------------------------------------------------------------------
   501 				;
   502 				; WRITE
   503 				;
   504 = D000			HPOSP0	EQU	GTIA+$00
   505 = D001			HPOSP1	EQU	GTIA+$01
   506 = D002			HPOSP2	EQU	GTIA+$02
   507 = D003			HPOSP3	EQU	GTIA+$03
   508 = D004			HPOSM0	EQU	GTIA+$04
   509 = D005			HPOSM1	EQU	GTIA+$05
   510 = D006			HPOSM2	EQU	GTIA+$06
   511 = D007			HPOSM3	EQU	GTIA+$07
   512 = D008			SIZEP0	EQU	GTIA+$08
   513 = D009			SIZEP1	EQU	GTIA+$09
   514 = D00A			SIZEP2	EQU	GTIA+$0a
   515 = D00B			SIZEP3	EQU	GTIA+$0b
   516 = D00C			SIZEM 	EQU	GTIA+$0c
   517 = D00D			GRAFP0	EQU	GTIA+$0d
   518 = D00E			GRAFP1	EQU	GTIA+$0e
   519 = D00F			GRAFP2	EQU	GTIA+$0f
   520 = D010			GRAFP3	EQU	GTIA+$10
   521 = D011			GRAFM 	EQU	GTIA+$11
   522 = D012			COLPM0	EQU	GTIA+$12
   523 = D013			COLPM1	EQU	GTIA+$13
   524 = D014			COLPM2	EQU	GTIA+$14
   525 = D015			COLPM3	EQU	GTIA+$15
   526 = D016			COLPF0	EQU	GTIA+$16
   527 = D017			COLPF1	EQU	GTIA+$17
   528 = D018			COLPF2	EQU	GTIA+$18
   529 = D019			COLPF3	EQU	GTIA+$19
   530 = D01A			COLBAK	EQU	GTIA+$1a
   531 = D01B			PRIOR 	EQU	GTIA+$1b
   532 = D01C			VDELAY	EQU	GTIA+$1c
   533 = D01D			GRACTL	EQU	GTIA+$1d
   534 = D01E			HITCLR	EQU	GTIA+$1e
   535 = D01F			CONSOL	EQU	GTIA+$1f
   536 				;
   537 				; READ
   538 				;
   539 = D000			M0PF  	EQU	GTIA+$00
   540 = D001			M1PF  	EQU	GTIA+$01
   541 = D002			M2PF  	EQU	GTIA+$02
   542 = D003			M3PF  	EQU	GTIA+$03
   543 = D004			P0PF  	EQU	GTIA+$04
   544 = D005			P1PF  	EQU	GTIA+$05
   545 = D006			P2PF  	EQU	GTIA+$06
   546 = D007			P3PF  	EQU	GTIA+$07
   547 = D008			M0PL  	EQU	GTIA+$08
   548 = D009			M1PL  	EQU	GTIA+$09
   549 = D00A			M2PL  	EQU	GTIA+$0a
   550 = D00B			M3PL  	EQU	GTIA+$0b
   551 = D00C			P0PL  	EQU	GTIA+$0c
   552 = D00D			P1PL  	EQU	GTIA+$0d
   553 = D00E			P2PL  	EQU	GTIA+$0e
   554 = D00F			P3PL  	EQU	GTIA+$0f
   555 = D010			TRIG0 	EQU	GTIA+$10
   556 = D011			TRIG1 	EQU	GTIA+$11
   557 = D012			TRIG2 	EQU	GTIA+$12
   558 = D013			TRIG3 	EQU	GTIA+$13
   559 = D014			PAL     EQU GTIA+$14
   560 				;
   561 				;
   562 				; ---------------------------------------------------------------------------
   563 = D400			ANTIC 	EQU	$D400
   564 				; ---------------------------------------------------------------------------
   565 				;
   566 = D400			DMACTL	EQU	ANTIC+$00
   567 = D401			CHACTL	EQU	ANTIC+$01
   568 = D402			DLPTR	EQU	ANTIC+$02
   569 				;DLISTH	EQU	ANTIC+$03
   570 = D404			HSCROL	EQU	ANTIC+$04
   571 = D405			VSCROL	EQU	ANTIC+$05
   572 = D407			PMBASE	EQU	ANTIC+$07
   573 = D409			CHBASE	EQU	ANTIC+$09
   574 = D40A			WSYNC 	EQU	ANTIC+$0a
   575 = D40B			VCOUNT	EQU	ANTIC+$0b
   576 = D40C			PENH  	EQU	ANTIC+$0c
   577 = D40D			PENV  	EQU	ANTIC+$0d
   578 = D40E			NMIEN 	EQU	ANTIC+$0e
   579 = D40F			NMIRES	EQU	ANTIC+$0f
   580 = D40F			NMIST 	EQU	ANTIC+$0f
   581 				;
   582 				;
   583 				; ---------------------------------------------------------------------------
   584 = D300			PIA   	EQU	$D300
   585 				; ---------------------------------------------------------------------------
   586 				;
   587 = D300			PORTA 	EQU	PIA+0
   588 = D301			PORTB 	EQU	PIA+1
   589 = D302			PACTL 	EQU	PIA+2
   590 = D303			PBCTL 	EQU	PIA+3
   591 				;
   592 				; ---------------------------------------------------------------------------
   593 				;                 Atari ANTIC chip display list equates
   594 				; ---------------------------------------------------------------------------
   595 				;
   596 = 0001			JUMP	EQU	$01	; display list jump instruction (3 byte)
   597 = 0041			JVB	    EQU	$41	; display list jump and wait for vblank instruction (3)
   598 				;
   599 = 0010			SCH	    EQU	$10	; display list horizontal scrolling
   600 = 0020			SCV	    EQU	$20	; display list vertical scrolling
   601 = 0040			LMS	    EQU	$40	; display list load memory scan instruction (3 byte)
   602 = 0080			DLII	EQU	$80	; display list interrupt instruction
   603 				;
   604 = 0000			SKIP1	EQU	$00	; display list skip 1 scan line instruction
   605 = 0010			SKIP2	EQU	$10	; display list skip 2 scan lines instruction
   606 = 0020			SKIP3	EQU	$20	; display list skip 3 scan lines instruction
   607 = 0030			SKIP4	EQU	$30	; display list skip 4 scan lines instruction
   608 = 0040			SKIP5	EQU	$40	; display list skip 5 scan lines instruction
   609 = 0050			SKIP6	EQU	$50	; display list skip 6 scan lines instruction
   610 = 0060			SKIP7	EQU	$60	; display list skip 7 scan lines instruction
   611 = 0070			SKIP8	EQU	$70	; display list skip 8 scan lines instruction
   612 				;
   613 = 0002			MODE2	EQU	$02	; display list mode 2
   614 = 0004			MODE4	EQU	$04	; display list mode 4
   615 = 0008			MODE8	EQU	$08	; display list mode 8
   616 = 000E			MODEE	EQU	$0E	; display list mode E
   617 = 000F			MODEF	EQU	$0F	; display list mode F
   618 				; ---------------------------------------------------------------------------
   619 				; ENUMS
   620 				; ---------------------------------------------------------------------------
   621
   622 				.enum   @dmactl
   623 = 0000			    blank   =    %00
   624 = 0001			    narrow  =    %01
   625 = 0002			    standard=    %10
   626 = 0003			    wide    =    %11
   627 = 0004			    missiles=   %100
   628 = 0008			    players =  %1000
   629 = 0010			    lineX1  = %10000
   630 = 0000			    lineX2  = %00000
   631 = 0020			    dma =    %100000
   632 				.ende
   633
   634 = 003F			scr48   = @dmactl(wide|dma|players|missiles|lineX1)
   635 = 003E			scr40   = @dmactl(standard|dma|players|missiles|lineX1)
   636 = 003D			scr32   = @dmactl(narrow|dma|players|missiles|lineX1)
   637
   638 				.enum   @pmcntl
   639 = 0001			    missiles=   %1
   640 = 0002			    players =  %10
   641 = 0004			    trigs   = %100
   642 				.ende
   643
   644 				.enum   @gtictl
   645 = 0000			    prior0  =        %0
   646 = 0001			    prior1  =        %1
   647 = 0002			    prior2  =       %10
   648 = 0004			    prior4  =      %100
   649 = 0008			    prior8  =     %1000
   650 = 0010			    ply5    =    %10000 ; Fifth Player Enable
   651 = 0020			    mlc     =   %100000 ; Multiple Color Player Enable
   652 = 0040			    mode9   = %01000000
   653 = 0080			    mode10  = %10000000
   654 = 00C0			    mode11  = %11000000
   655 				.ende
   656 				; ---------------------------------------------------------------------------
   657 				; KBCODEs
   658 				; ---------------------------------------------------------------------------
   659 				.enum @kbcode
   660 = 00FF			    _none  = 255
   661 = 001C			    _esc   = 28
   662 = 001F			    _1     = 31
   663 = 001E			    _2     = 30
   664 = 001A			    _3     = 26
   665 = 0018			    _4     = 24
   666 = 001D			    _5     = 29
   667 = 001B			    _6     = 27
   668 = 0033			    _7     = 51
   669 = 0035			    _8     = 53
   670 = 0030			    _9     = 48
   671 = 0032			    _0     = 50
   672 = 0036			    _lt    = 54
   673 = 0037			    _gt    = 55
   674 = 0034			    _del   = 52
   675 = 002C			    _tab   = 44
   676 = 002F			    _Q     = 47
   677 = 002E			    _W     = 46
   678 = 002A			    _E     = 42
   679 = 0028			    _R     = 40
   680 = 002D			    _T     = 45
   681 = 002B			    _Y     = 43
   682 = 000B			    _U     = 11
   683 = 000D			    _I     = 13
   684 = 0008			    _O     = 8
   685 = 000A			    _P     = 10
   686 = 000E			    _min   = 14
   687 = 000E			    _up    =  14  ; cursor function 
   688 = 000F			    _eq    = 15
   689 = 000F			    _down  = 15 ; cursor function
   690 = 000C			    _ret   = 12
   691 = 003F			    _A     = 63
   692 = 003E			    _S     = 62
   693 = 003A			    _D     = 58
   694 = 0038			    _F     = 56
   695 = 003D			    _G     = 61
   696 = 0039			    _H     = 57
   697 = 0001			    _J     = 1
   698 = 0005			    _K     = 5
   699 = 0000			    _L     = 0
   700 = 0002			    _semicolon = 2
   701 = 0006			    _plus  = 6
   702 = 0006			    _left  = 6  ; cursor function
   703 = 0007			    _asterisk = 7
   704 = 0007			    _right = 7 ; cursor function
   705 = 003C			    _caps  = 60
   706 = 0017			    _Z     = 23
   707 = 0016			    _X     = 22
   708 = 0012			    _C     = 18
   709 = 0010			    _V     = 16
   710 = 0015			    _B     = 21
   711 = 0024			    _N     = 36
   712 = 0025			    _M     = 37
   713 = 0020			    _comma = 32
   714 = 0022			    _dot   = 34
   715 = 0026			    _slash = 38
   716 = 0027			    _atari = 39
   717 = 0011			    _help  = 17
   718 = 0003			    _F1    = 3
   719 = 0004			    _F2    = 4
   720 = 0013			    _F3    = 19
   721 = 0014			    _F4    = 20
   722 = 0021			    _space = 33
   723 				.ende
   724 = 009B			EOL = $9b
   724 = 0080			TEMP_W
   724 = 0082			TEMP_B
   724 = 0083			DINOWALKPHASE
   724 = 0084			DINOSTATE
   724 = 0085			JUMPPHASE
    18 				    icl 'lib/MACRO.ASM'
Source: MACRO.ASM
     1 				;-------------------------------------
     2 				  .MACRO ROLW
     3 				     ROL :1
     4 				    ROL :1+1
     5 				  .ENDM
     6 				;-------------------------------------
     7 				  .MACRO ASLW
     8 				    ASL :1
     9 				    ROL :1+1
    10 				  .ENDM
    11 				;-------------------------------------
    12 				  .MACRO RORW
    13 				    ROR :1+1
    14 				    ROR :1
    15 				  .ENDM
    16 				;-------------------------------------
    17 				  .MACRO LSRW
    18 				    LSR :1+1
    19 				    ROR :1
    20 				  .ENDM
    21
    22 				;-------------------------------------
    23 				         .MACRO VMAIN
    24 				;	VMAIN #WORD,interrupt.vector
    25 				; interrupt.vector:
    26 				;    0 - VIMIRQ
    27 				;    1 - TIMCNT1
    28 				;    2 - TIMCNT2
    29 				;    3 - TIMCNT3
    30 				;    4 - TIMCNT4
    31 				;    5 - TIMCNT5
    32 				;    6 - VVBLKI
    33 				;    7 - VVBLKD
    34 				;    8 - TIMVEC1
    35 				;    9 - TIMVEC2
    36 				;	Initialises Vertical Blank Interrupts
    37 				;       (works only with system interrupts ON)
    38 				         LDY # <:1
    39 				         LDX # >:1
    40 				         LDA #:2
    41 				         JSR SETVBV
    42 				         .ENDM
    43 				;-------------------------------------
    44 				         .MACRO VDLI
    45 				;	VDLI #WORD
    46 				;	Initialises Display List Interrupts
    47 				         LDY # <:1
    48 				         LDX # >:1
    49 				         LDA #$C0
    50 				         STY $0200
    51 				         STX $0201
    52 				         STA NMIEN
    53 				         .ENDM
    54 				;-------------------------------------
    55 				        .MACRO VDL
    56 				;   VDL #WORD
    57 				;   Changes Display List addres
    58 				; and sets width of the screen
    59 				;    vdl dl,$01 - narrow screen (32 bytes)
    60 				;    vdl dl,$02 - normal screen (40 bytes)
    61 				;    vdl dl,$03 - wide screen   (48 bytes)
    62 				;       (works only with system interrupts ON)
    63 				
    64 				         .if %0=2
    65 				           lda dmactls
    66 				           and #$fc
    67 				           ora #%2
    68 				           sta dmactls
    69 				         .endif
    70 				
    71 				         LDA # <%1
    72 				         STA DLPTRS
    73 				         LDA # >%1
    74 				         STA DLPTRS+1
    75 				         .ENDM
    76 				;-------------------------------------
    77 				      .MACRO halt
    78 				?stop  
    79 				      lda RANDOM 
    80 				      and #$05
    81 				      sta COLBAK
    82 				      jmp ?stop
    83 				      .ENDM
    84 				;-------------------------------------
    85 				         .MACRO KEY
    86 				;	KEY
    87 				;	waits for releasing and pressing "any key"
    88 				         PHA
    89 				?CK1      LDA SKSTAT
    90 				         AND #$04
    91 				         BEQ ?CK1
    92 				?CK       LDA SKSTAT
    93 				         AND #$04
    94 				         BNE ?CK
    95 				         PLA
    96 				         .ENDM
    97 				;-------------------------------------
    98 					.MACRO WAIT
    99 				;	WAIT
   100 				;	waits one frame (1/50 s(PAL) or 1/60s(NTSC))
   101 				?ze	LDA VCOUNT
   102 					cmp #16	; if line<16 then wait for line>15 (long VBI protection)
   103 					bcc ?ze
   104 					sbc #10	; last lines correction
   105 				?wa	cmp VCOUNT
   106 					bcc ?wa
   107 				?wf	cmp VCOUNT
   108 					bcs ?wf
   109 					.ENDM
   110 				;-------------------------------------
   111 					.macro waitRTC
   112 					lda RTCLOK+2
   113 				?wa	cmp RTCLOK+2
   114 					beq ?wa
   115 					.endm
   116 				;-------------------------------------
   117 				    .macro negw
   118 				    ; negate the given word (0-a)
   119 				;-------------------------------------
   120 				        sec
   121 				        lda #$00
   122 				        sbc :1
   123 				        sta :1
   124 				        lda #$00
   125 				        sbc :1+1
   126 				        sta :1+1
   127 				    .endm
   128 				;-------------------------------------
   129 				    .macro randomize
   130 				    ;usage: randomize floor ceiling
   131 				    ;returns (in A) a random .byte between "floor" and "ceiling"
   132 				    .if :2 < :1
   133 				      .error "floor higher than ceiling"
   134 				    .endif
   135 				?rand
   136 				      lda random
   137 				      cmp #:2+1-:1 ;ceiling
   138 				      bcs ?rand
   139 				    .if %1>0    ; if floor = 0 - no add offset
   140 				      adc #:1
   141 				    .endif
   142 				    .endm
   143 				;-------------------------------------
   144 				    .macro phx
   145 				      txa
   146 				      pha
   147 				    .endm
   148 				;-------------------------------------
   149 				    .macro phy
   150 				      tya
   151 				      pha
   152 				    .endm
   153 				;-------------------------------------
   154 				    .macro plx
   155 				      pla
   156 				      tax
   157 				    .endm
   158 				;-------------------------------------
   159 				    .macro ply
   160 				      pla
   161 				      tay
   162 				    .endm
   163 				;-------------------------------------
   164 				    .macro txy
   165 				      txa
   166 				      tay
   167 				    .endm
   168 				;-------------------------------------
   169 				    .macro tyx
   170 				      tya
   171 				      tax
   172 				    .endm
   173 				;-------------------------------------
   174 				    .macro pause
   175 				      ;waits :1 number (byte) of frames
   176 				      ldx #:1
   177 				?PAUSELOOP
   178 				      wait
   179 				      dex
   180 				      bne ?PAUSELOOP
   181 				    .ENDM
   182
    19 				;---------------------------------------------------
    20 				    ; dark screean and BASIC off
    21 				    ORG $2000
    22 FFFF> 2000-2024> A9 00 +     mva #0 dmactls             ; dark screen
    23 2005 A9 FF 8D 01 D3	    mva #$ff portb
    24 				    ; and wait one frame :)
    25 200A F0 13200C		 wait                   
Macro: WAIT [Source: MACRO.ASM]
     3 200C AD 0B D4		?ze	LDA VCOUNT
     4 200F C9 10			cmp #16	; if line<16 then wait for line>15 (long VBI protection)
     5 2011 90 F9			bcc ?ze
     6 2013 E9 0A			sbc #10	; last lines correction
     7 2015 CD 0B D4		?wa	cmp VCOUNT
     8 2018 90 FB			bcc ?wa
     9 201A CD 0B D4		?wf	cmp VCOUNT
    10 201D B0 FB			bcs ?wf
Source: dino.asm
    seq:wait                   ; or waitRTC ?
    26 201F A9 FF 8D 01 D3	    mva #$ff portb        ; BASIC off
    27 2024 60			    rts
    28 02E2-02E3> 00 20		    ini $2000
    29 				;---------------------------------------------------
    30
    31 				    org $2000
    32 				;---------------------------------------------------
    33 				; 4 charsets for fine scroll
    34 2000			font1
    35 2000-2FFF> 00 00 00 00 +     ins 'artwork/dino1.fnt'  ; 1 charset
    36 = 2400			font2 = font1+$400
    37 2400 00 00 00 00 00 00 +     ins 'artwork/dino2.fnt'  ; 2 charset
    38 = 2800			font3 = font2+$400
    39 2800 00 00 00 00 00 00 +     ins 'artwork/dino3.fnt'  ; 3 charset
    40 = 2C00			font4 = font3+$400
    41 2C00 00 00 00 00 00 00 +     ins 'artwork/dino4.fnt'  ; 4 charset
    42 				    org font4+$400
    43 				; screen data
    44 				; SCR_HEIGHT lines 256bytes each
    45 3000			screen
    46 = 3000			    .ds $100*SCR_HEIGHT
    47 				; display list
    48 3800			GameDL
    49 3800-3D7A> 70 70 70 70 +     :15 .byte SKIP8   ; empty lines
    50
    51 				    .rept SCR_HEIGHT, #
    52 				      .BYTE MODE2+LMS+SCH   
    53 				LINE:1_ADDR
    54 				        .WORD SCREEN+$100*#
    55 				    .endr
Source: REPT
    52 380F 52			      .BYTE MODE2+LMS+SCH   
    52 3810			LINE0_ADDR
    52 3810 00 30		        .WORD SCREEN+$100*#
    52 3812 52			      .BYTE MODE2+LMS+SCH   
    52 3813			LINE1_ADDR
    52 3813 00 31		        .WORD SCREEN+$100*#
    52 3815 52			      .BYTE MODE2+LMS+SCH   
    52 3816			LINE2_ADDR
    52 3816 00 32		        .WORD SCREEN+$100*#
    52 3818 52			      .BYTE MODE2+LMS+SCH   
    52 3819			LINE3_ADDR
    52 3819 00 33		        .WORD SCREEN+$100*#
    52 381B 52			      .BYTE MODE2+LMS+SCH   
    52 381C			LINE4_ADDR
    52 381C 00 34		        .WORD SCREEN+$100*#
    52 381E 52			      .BYTE MODE2+LMS+SCH   
    52 381F			LINE5_ADDR
    52 381F 00 35		        .WORD SCREEN+$100*#
    52 3821 52			      .BYTE MODE2+LMS+SCH   
    52 3822			LINE6_ADDR
    52 3822 00 36		        .WORD SCREEN+$100*#
    52 3824 52			      .BYTE MODE2+LMS+SCH   
    52 3825			LINE7_ADDR
    52 3825 00 37		        .WORD SCREEN+$100*#
Source: dino.asm
    56 3827 41			    .byte JVB   
    57 3828 00 38		    .word GameDL
    58 				;---------------------------------------------------
    59 				; World table without dino
    60 382A			WorldTable
    61 382A 00 00 00 00 00 00 +     :WORLD_LENGTH .byte 0 ; ground
    62 				;---------------------------------------------------
    63 386A			FirstSTART
    64 386A 20 0D 39		    jsr GenerateCharsets
    65 386D 20 2E 3C		    jsr SetStart
    66 3870 20 58 3C		    jsr SetGameScreen
    67 3873 A9 00 8D 7B 3D	    mva #0 diff_level
    68 				    
    69 				    ; test only (some object in the world)
    70 3878 A9 01		    lda #1  ;bird0
    71 387A 8D 34 38		    sta WorldTable+10
    72 387D A9 04		    lda #4  ;cactus
    73 387F 8D 3E 38		    sta WorldTable+20
    74 3882 A9 84		    lda #4+$80  ; cactus (second char)
    75 3884 8D 3F 38		    sta WorldTable+21
    76 				    ;
    77 3887 A2 05		    ldx #5 ; position
    78 3889 A0 00		    ldy #0  ; shape
    79 388B 20 42 3A		    jsr ShowDino
    80 388E A2 0A		    ldx #10 ; position
    81 3890 A0 01		    ldy #1  ; shape
    82 3892 20 42 3A		    jsr ShowDino
    83 3895 A2 0F		    ldx #15 ; position
    84 3897 A0 02		    ldy #2  ; shape
    85 3899 20 42 3A		    jsr ShowDino
    86 389C A2 14		    ldx #20 ; position
    87 389E A0 03		    ldy #3  ; shape
    88 38A0 20 42 3A		    jsr ShowDino
    89 38A3 A2 19		    ldx #25 ; position
    90 38A5 A0 04		    ldy #4  ; shape
    91 38A7 20 42 3A		    jsr ShowDino
    92 38AA A9 50 8D 20 37	    mva #$50 screen+$700+32
    93 38AF			EndLoop
    94 38AF 20 72 39		    jsr WorldShift
    95 				    ;lda #$32
    96 				    ;sta COLBAK
    97 38B2 20 59 39		    jsr WorldToScreen
    98 38B5 20 42 3A		    jsr ShowDino
    99 				    ;lda #$5f
   100 				    ;sta COLBAK
   101 38B8 20 07 3C		    jsr CheckJoy
   102 				    ;waitRTC                   ; or waitRTC ?
   103 				    ;key
   104 38BB A9 24 8D F4 02	    mva #>font2 chbas
   105 38C0			    waitRTC                   ; or waitRTC ?
Macro: WAITRTC [Source: MACRO.ASM]
     1 38C0 A5 14			lda RTCLOK+2
     2 38C2 C5 14		?wa	cmp RTCLOK+2
     3 38C4 F0 FC			beq ?wa
Source: dino.asm
   106 38C6 A9 03 8D 04 D4	    mva #3 hscrol
   107 				    ;waitRTC                   ; or waitRTC ?
   108 				    ;key
   109 38CB A9 28 8D F4 02	    mva #>font3 chbas
   110 38D0			    waitRTC                   ; or waitRTC ?
Macro: WAITRTC [Source: MACRO.ASM]
     1 38D0 A5 14			lda RTCLOK+2
     2 38D2 C5 14		?wa	cmp RTCLOK+2
     3 38D4 F0 FC			beq ?wa
Source: dino.asm
   111 38D6 A9 02 8D 04 D4	    mva #2 hscrol
   112 				    ;waitRTC                   ; or waitRTC ?
   113 				    ;key
   114 38DB A9 2C 8D F4 02	    mva #>font4 chbas
   115 38E0			    waitRTC                   ; or waitRTC ?
Macro: WAITRTC [Source: MACRO.ASM]
     1 38E0 A5 14			lda RTCLOK+2
     2 38E2 C5 14		?wa	cmp RTCLOK+2
     3 38E4 F0 FC			beq ?wa
Source: dino.asm
   116 38E6 A9 01 8D 04 D4	    mva #1 hscrol
   117 				    ;waitRTC                   ; or waitRTC ?
   118 				    ;key
   119 38EB 20 B4 39		    jsr Animate
   120 38EE A9 20 8D F4 02	    mva #>font1 chbas
   121 38F3			    waitRTC                   ; or waitRTC ?
Macro: WAITRTC [Source: MACRO.ASM]
     1 38F3 A5 14			lda RTCLOK+2
     2 38F5 C5 14		?wa	cmp RTCLOK+2
     3 38F7 F0 FC			beq ?wa
Source: dino.asm
   122 38F9 A9 04 8D 04 D4	    mva #4 hscrol
   123 38FE 4C AF 38		    jmp EndLoop
   124 3901			    halt
Macro: HALT [Source: MACRO.ASM]
     1 3901			?stop  
     2 3901 AD 0A D2		      lda RANDOM 
     3 3904 29 05		      and #$05
     4 3906 8D 1A D0		      sta COLBAK
     5 3909 4C 01 39		      jmp ?stop
Source: dino.asm
   125 390C 60			    rts
   126
   127 				;-----------------------------------------------
   128 				; Generation of character sets 2,3 and 4 of 1
   129 				; By copying and horizontal shift dino
   130 				;-----------------------------------------------
   131 390D			.proc GenerateCharsets
   132 				    ; copy charset 1 to 2,3 and 4 (but not dino chars)
   133 390D A0 00		    ldy #0
   134 390F			CopyLoop
   135 390F B9 00 20		    lda font1,y
   136 3912 99 00 24		    sta font2,y
   137 3915 99 00 28		    sta font3,y
   138 3918 99 00 2C		    sta font4,y
   139 391B B9 00 22		    lda font1+$200,y
   140 391E 99 00 26		    sta font2+$200,y
   141 3921 99 00 2A		    sta font3+$200,y
   142 3924 99 00 2E		    sta font4+$200,y
   143 3927 B9 00 23		    lda font1+$300,y
   144 392A 99 00 27		    sta font2+$300,y
   145 392D 99 00 2B		    sta font3+$300,y
   146 3930 99 00 2F		    sta font4+$300,y
   147 3933 C8			    iny
   148 3934 D0 D9		    bne CopyLoop
   149 				    
   150 3936 60			    rts
   151 				.endp
   152 				;-----------------------------------------------
   153 3937			.proc ClearWorld
   154 3937 A0 3F		    ldy #WORLD_LENGTH-1 ; world size
   155 3939 A9 00		    lda #0  ; ground
   156 393B 99 2A 38		@   sta WorldTable,y
   157 393E 88			    dey
   158 393F 10 FA		    bpl @-
   159 3941 60			    rts
   160 				.endp
   161 3942			.proc ClearScreen
   162 3942 A0 40		    ldy #WORLD_LENGTH ; TODO: shouldn't be -1?
   163 3944 A9 00		    lda #0
   164 3946			ClearLoop
   165 3946 99 00 37		    sta screen+$700,y
   166 3949 99 00 36		    sta screen+$600,y
   167 394C 99 00 35		    sta screen+$500,y
   168 394F 99 00 34		    sta screen+$400,y
   169 3952 99 00 33		    sta screen+$300,y
   170 3955 88			    dey
   171 3956 10 EE		    bpl ClearLoop
   172 3958 60			    rts
   173 				.endp
   174 				;-----------------------------------------------
   175 3959			.proc WorldToScreen
   176 3959 20 42 39		    jsr ClearScreen
   177 395C A2 00		    ldx #0  ; start position
   178 395E 86 82		    stx temp_b
   179 3960			ToScreenLoop
   180 3960 BD 2A 38		    lda WorldTable,x
   181 3963 30 04		    bmi NothingToDraw
   182 3965 A8			    tay
   183 3966 20 E7 39		    jsr ShowObject
   184 3969			NothingToDraw
   185 3969 E6 82		    inc temp_b
   186 396B A6 82		    ldx temp_b
   187 396D E0 40		    cpx #WORLD_LENGTH
   188 396F D0 EF		    bne ToScreenLoop
   189 3971 60			    rts
   190 				.endp
   191 				;-----------------------------------------------
   192 3972			.proc WorldShift
   193 3972 A0 00		    ldy #0
   194 3974			Shift
   195 3974 B9 2B 38		    lda WorldTable+1,y
   196 3977 99 2A 38		    sta WorldTable,y
   197 397A C8			    iny
   198 397B C0 3F		    cpy #WORLD_LENGTH-1
   199 397D D0 F5		    bne Shift
   200 397F A9 00		    lda #0  ;ground
   201 3981 99 2A 38		    sta WorldTable,y
   202 				    ; now we can insert random object to world end
   203 				    
   204 				    ; check if there is enough of the gap between obstacles
   205 				    
   206 				    ; get the gap for the given difficulty level
   207 3984 AE 7B 3D		    ldx diff_level
   208 3987 A9 40		    lda #WORLD_LENGTH
   209 3989 38			    sec
   210 398A FD 6B 3D		    sbc diff_object_gap,x
   211 398D AA			    tax 
   212
   213 				    ; is there a gap?
   214 				@
   215 398E BD 2A 38		    lda WorldTable,x
   216 3991 D0 20		    bne noInsert
   217 3993 E8			    inx
   218 3994 E0 40		    cpx #WORLD_LENGTH
   219 3996 D0 F6		    bne @-
   220 				    ;all zeroes
   221 3998			insertObject
   222 3998 AD 0A D2		    lda RANDOM
   223 399B 29 01		    and #%00000001  ; insert 50/50
   224 399D F0 14		    beq noInsert
   225 399F			    randomize 8 13  ; cactuses and hole
Macro: RANDOMIZE [Source: MACRO.ASM]
     6 399F			?rand
     7 399F AD 0A D2		      lda random
     8 39A2 C9 06		      cmp #13+1-8 ;ceiling
     9 39A4 B0 F9		      bcs ?rand
    11 39A6 69 08		      adc #8
Source: dino.asm
   226 39A8 8D 68 38		    sta WorldTable+WORLD_LENGTH-2
   227 39AB 09 80		    ora #$80
   228 39AD 8D 69 38		    sta WorldTable+WORLD_LENGTH-1
   229 39B0 EE 7B 3D		    inc diff_level
   230 				    
   231 				    
   232 				    
   233 39B3			noInsert    
   234 39B3 60			    rts
   235 				.endp
   236 				;-----------------------------------------------
   237 39B4			.proc Animate
   238 39B4 A0 40		    ldy #WORLD_LENGTH
   239 39B6 B9 2A 38		@   lda WorldTable,y
   240 39B9 AA			    tax
   241 39BA 29 7F		    and #%01111111
   242 39BC F0 0A		    beq NoBird
   243 39BE C9 08		    cmp #8 ; first cactus
   244 39C0 B0 06		    bcs NoBird
   245 				    ; then animate bird
   246 39C2 8A			    txa
   247 39C3 49 01		    eor #%0000001
   248 39C5 99 2A 38		    sta WorldTable,y
   249 39C8			NoBird
   250 39C8 88			    dey
   251 39C9 10 EB		    bpl @-
   252 				    ; animate Dino
   253 39CB A5 83		    lda DinoWalkPhase
   254 39CD 49 01		    eor #%00000001
   255 39CF 85 83		    sta DinoWalkPhase
   256 				    ; jump
   257 39D1 A5 84		    lda DinoState
   258 39D3 C9 04		    cmp #4  ; jump state
   259 39D5 D0 0F		    bne NoJump
   260 39D7 A5 85		    lda JumpPhase
   261 39D9 C9 08		    cmp #JumpLen  ; max jump phase
   262 39DB F0 03		    beq EndJump
   263 39DD E6 85		    inc JumpPhase
   264 39DF 60			    rts
   265 39E0			EndJump
   266 39E0 A9 00		    lda #0
   267 39E2 85 85		    sta JumpPhase
   268 39E4 85 84		    sta DinoState
   269 39E6			NoJump
   270 39E6 60			    rts
   271 				.endp
   272 				;-----------------------------------------------
   273 				; Show Object on screen
   274 				; X - y position
   275 				; Y - shape nr
   276 				;-----------------------------------------------
   277 39E7			.proc ShowObject
   278 39E7 B9 4D 3D		    lda ShapesTableL,y
   279 39EA 85 80		    sta temp_w
   280 39EC B9 5C 3D		    lda ShapesTableH,y
   281 39EF 85 81		    sta temp_w+1
   282 39F1 A0 00		    ldy #0
   283 39F3			ObjectLoop
   284 39F3 B1 80		    lda (temp_w),y
   285 39F5 30 03		    bmi @+
   286 39F7 9D 00 34		    sta screen+$400,x
   287 39FA 18 A5 80 69 02 85 + @   adw temp_w #2
   288 3A05 B1 80		    lda (temp_w),y
   289 3A07 30 03		    bmi @+
   290 3A09 9D 00 35		    sta screen+$500,x
   291 3A0C 18 A5 80 69 02 85 + @   adw temp_w #2
   292 3A17 B1 80		    lda (temp_w),y
   293 3A19 30 03		    bmi @+
   294 3A1B 9D 00 36		    sta screen+$600,x
   295 3A1E 18 A5 80 69 02 85 + @   adw temp_w #2
   296 3A29 B1 80		    lda (temp_w),y
   297 3A2B 30 03		    bmi @+
   298 3A2D 9D 00 37		    sta screen+$700,x
   299 3A30 38 A5 80 E9 06 85 + @   sbw temp_w #6
   300 3A3B E8			    inx
   301 3A3C C8			    iny
   302 3A3D C0 02		    cpy #2  ; object width
   303 3A3F D0 B2		    bne ObjectLoop
   304 3A41 60			    rts
   305 				.endp
   306 				;-----------------------------------------------
   307 				; Show Dino on screen (test)
   308 				;-----------------------------------------------
   309 3A42			.proc ShowDino
   310 3A42 A2 05		    ldx #5 ; position
   311 3A44 A5 84		    lda DinoState
   312 3A46 05 83		    ora DinoWalkPhase  ; shape
   313 3A48 A8			    tay
   314 3A49 B9 D1 3C		    lda DinoShapesTableL,y
   315 3A4C 85 80		    sta temp_w
   316 3A4E B9 D7 3C		    lda DinoShapesTableH,y
   317 3A51 85 81		    sta temp_w+1
   318 3A53 C0 04		    cpy #4  ; jump
   319 3A55 F0 55		    beq Jump
   320 3A57 C0 05		    cpy #5  ; jump
   321 3A59 F0 51		    beq Jump
   322 3A5B A0 00		    ldy #0
   323 3A5D			DinoLoop
   324 3A5D B1 80		    lda (temp_w),y
   325 3A5F 30 03		    bmi @+
   326 3A61 9D 00 34		    sta screen+$400,x
   327 3A64 18 A5 80 69 05 85 + @   adw temp_w #5
   328 3A6F B1 80		    lda (temp_w),y
   329 3A71 30 03		    bmi @+
   330 3A73 9D 00 35		    sta screen+$500,x
   331 3A76 18 A5 80 69 05 85 + @   adw temp_w #5
   332 3A81 B1 80		    lda (temp_w),y
   333 3A83 30 03		    bmi @+
   334 3A85 9D 00 36		    sta screen+$600,x
   335 3A88 18 A5 80 69 05 85 + @   adw temp_w #5
   336 3A93 B1 80		    lda (temp_w),y
   337 3A95 30 03		    bmi @+
   338 3A97 9D 00 37		    sta screen+$700,x
   339 3A9A 38 A5 80 E9 0F 85 + @   sbw temp_w #15
   340 3AA5 E8			    inx
   341 3AA6 C8			    iny
   342 3AA7 C0 05		    cpy #5  ; dino width
   343 3AA9 D0 B2		    bne DinoLoop
   344 3AAB 60			    rts
   345 3AAC			Jump
   346 3AAC A4 85		    ldy JumpPhase
   347 3AAE B9 7C 3D		    lda DinoJumpTr,y
   348 3AB1 C9 02		    cmp #2
   349 3AB3 F0 5F		    beq jPhase2
   350 3AB5 C9 03		    cmp #3
   351 3AB7 D0 03 4C 65 3B	    jeq jPhase3
   352 3ABC C9 04		    cmp #4
   353 3ABE D0 03 4C B6 3B	    jeq jPhase4
   354 3AC3			jPhase1
   355 3AC3 A0 00		    ldy #0
   356 3AC5			DinoLoop1
   357 3AC5 B1 80		    lda (temp_w),y
   358 3AC7 30 03		    bmi @+
   359 3AC9 9D 00 33		    sta screen+$300,x
   360 3ACC 18 A5 80 69 05 85 + @   adw temp_w #5
   361 3AD7 B1 80		    lda (temp_w),y
   362 3AD9 30 03		    bmi @+
   363 3ADB 9D 00 34		    sta screen+$400,x
   364 3ADE 18 A5 80 69 05 85 + @   adw temp_w #5
   365 3AE9 B1 80		    lda (temp_w),y
   366 3AEB 30 03		    bmi @+
   367 3AED 9D 00 35		    sta screen+$500,x
   368 3AF0 18 A5 80 69 05 85 + @   adw temp_w #5
   369 3AFB B1 80		    lda (temp_w),y
   370 3AFD 30 03		    bmi @+
   371 3AFF 9D 00 36		    sta screen+$600,x
   372 3B02 38 A5 80 E9 0F 85 + @   sbw temp_w #15
   373 3B0D E8			    inx
   374 3B0E C8			    iny
   375 3B0F C0 05		    cpy #5  ; dino width
   376 3B11 D0 B2		    bne DinoLoop1
   377 3B13 60			    rts
   378 3B14			jPhase2
   379 3B14 A0 00		    ldy #0
   380 3B16			DinoLoop2
   381 3B16 B1 80		    lda (temp_w),y
   382 3B18 30 03		    bmi @+
   383 3B1A 9D 00 32		    sta screen+$200,x
   384 3B1D 18 A5 80 69 05 85 + @   adw temp_w #5
   385 3B28 B1 80		    lda (temp_w),y
   386 3B2A 30 03		    bmi @+
   387 3B2C 9D 00 33		    sta screen+$300,x
   388 3B2F 18 A5 80 69 05 85 + @   adw temp_w #5
   389 3B3A B1 80		    lda (temp_w),y
   390 3B3C 30 03		    bmi @+
   391 3B3E 9D 00 34		    sta screen+$400,x
   392 3B41 18 A5 80 69 05 85 + @   adw temp_w #5
   393 3B4C B1 80		    lda (temp_w),y
   394 3B4E 30 03		    bmi @+
   395 3B50 9D 00 35		    sta screen+$500,x
   396 3B53 38 A5 80 E9 0F 85 + @   sbw temp_w #15
   397 3B5E E8			    inx
   398 3B5F C8			    iny
   399 3B60 C0 05		    cpy #5  ; dino width
   400 3B62 D0 B2		    bne DinoLoop2
   401 3B64 60			    rts
   402 3B65			jPhase3
   403 3B65 A0 00		    ldy #0
   404 3B67			DinoLoop3
   405 3B67 B1 80		    lda (temp_w),y
   406 3B69 30 03		    bmi @+
   407 3B6B 9D 00 31		    sta screen+$100,x
   408 3B6E 18 A5 80 69 05 85 + @   adw temp_w #5
   409 3B79 B1 80		    lda (temp_w),y
   410 3B7B 30 03		    bmi @+
   411 3B7D 9D 00 32		    sta screen+$200,x
   412 3B80 18 A5 80 69 05 85 + @   adw temp_w #5
   413 3B8B B1 80		    lda (temp_w),y
   414 3B8D 30 03		    bmi @+
   415 3B8F 9D 00 33		    sta screen+$300,x
   416 3B92 18 A5 80 69 05 85 + @   adw temp_w #5
   417 3B9D B1 80		    lda (temp_w),y
   418 3B9F 30 03		    bmi @+
   419 3BA1 9D 00 34		    sta screen+$400,x
   420 3BA4 38 A5 80 E9 0F 85 + @   sbw temp_w #15
   421 3BAF E8			    inx
   422 3BB0 C8			    iny
   423 3BB1 C0 05		    cpy #5  ; dino width
   424 3BB3 D0 B2		    bne DinoLoop3
   425 3BB5 60			    rts
   426 3BB6			jPhase4
   427 3BB6 A0 00		    ldy #0
   428 3BB8			DinoLoop4
   429 3BB8 B1 80		    lda (temp_w),y
   430 3BBA 30 03		    bmi @+
   431 3BBC 9D 00 30		    sta screen,x
   432 3BBF 18 A5 80 69 05 85 + @   adw temp_w #5
   433 3BCA B1 80		    lda (temp_w),y
   434 3BCC 30 03		    bmi @+
   435 3BCE 9D 00 31		    sta screen+$100,x
   436 3BD1 18 A5 80 69 05 85 + @   adw temp_w #5
   437 3BDC B1 80		    lda (temp_w),y
   438 3BDE 30 03		    bmi @+
   439 3BE0 9D 00 32		    sta screen+$200,x
   440 3BE3 18 A5 80 69 05 85 + @   adw temp_w #5
   441 3BEE B1 80		    lda (temp_w),y
   442 3BF0 30 03		    bmi @+
   443 3BF2 9D 00 33		    sta screen+$300,x
   444 3BF5 38 A5 80 E9 0F 85 + @   sbw temp_w #15
   445 3C00 E8			    inx
   446 3C01 C8			    iny
   447 3C02 C0 05		    cpy #5  ; dino width
   448 3C04 D0 B2		    bne DinoLoop4
   449 3C06 60			    rts
   450 				.endp
   451 				;-----------------------------------------------
   452 3C07			.proc CheckJoy
   453 3C07 A5 84		    lda DinoState
   454 3C09 C9 04		    cmp #4  ; jump state
   455 3C0B F0 12		    beq NoChange
   456 3C0D AD 78 02		    lda STICK0
   457 3C10 29 02		    and #%00000010  ; down
   458 3C12 F0 15		    beq Down
   459 3C14 AD 78 02		    lda STICK0
   460 3C17 29 01		    and #%00000001  ; up
   461 3C19 F0 05		    beq Up
   462 				    ; no change state (temporary set to 0)
   463 3C1B A9 00		    lda #0
   464 3C1D 85 84		    sta DinoState
   465 3C1F			NoChange
   466 3C1F 60			    rts
   467 3C20 A9 04		Up  lda #4
   468 3C22 85 84		    sta DinoState
   469 3C24 A9 00		    lda #0
   470 3C26 85 85		    sta JumpPhase
   471 3C28 60			    rts
   472 3C29			Down
   473 3C29 A9 02		    lda #2
   474 3C2B 85 84		    sta DinoState
   475 3C2D 60			    rts
   476 				.endp
   477 				;-----------------------------------------------
   478 3C2E			.proc SetStart
   479 3C2E 20 37 39		    jsr ClearWorld
   480 3C31 A9 00		    lda #0
   481 3C33 85 83		    sta DinoWalkPhase
   482 3C35 A9 00		    lda #0
   483 3C37 85 84		    sta DinoState
   484 3C39 8D C5 02		    sta COLOR1
   485 3C3C A0 00		    ldy #0
   486 3C3E			FadeColor
   487 3C3E 8C C6 02		    sty COLOR2
   488 3C41 8C C8 02		    sty COLOR4
   489 3C44			    waitRTC
Macro: WAITRTC [Source: MACRO.ASM]
     1 3C44 A5 14			lda RTCLOK+2
     2 3C46 C5 14		?wa	cmp RTCLOK+2
     3 3C48 F0 FC			beq ?wa
Source: dino.asm
   490 3C4A C8			    iny
   491 3C4B C0 10		    cpy #$10
   492 3C4D D0 EF		    bne FadeColor
   493 3C4F A9 0F		    lda #$0f
   494 3C51 8D C6 02		    sta COLOR2
   495 3C54 8D C8 02		    sta COLOR4
   496 3C57 60			    rts
   497 				.endp
   498 				;-----------------------------------------------
   499 3C58			.proc SetGameScreen
   500 3C58 A9 00 8D 30 02 A9 +     mwa #GameDL dlptrs
   501 3C62 A9 3E		    lda #%00111110  ; normal screen width, DL on, P/M on
   502 3C64 8D 2F 02		    sta dmactls
   503 3C67 A9 20 8D F4 02	    mva #>font1 chbas
   504 3C6C 60			    rts
   505 				.endp
   506 				;--------------------------------------------------
   507 3C6D			    icl 'artwork/shapes.asm'
Source: shapes.asm
     1 				;   @com.wudsn.ide.asm.mainsourcefile=dino.asm
     2
     3 				    .IF *>0 ;this is a trick that prevents compiling this file alone
     4
     5 				; dno run
     6 3C6D			dino_run_0  ; anly '0' jumps
     7 3C6D FF 23 27 2B FF	    .by $ff, $23, $27, $2b, $ff ; '.   .'
     8 3C72 20 24 28 2C FF	    .by $20, $24, $28, $2c, $ff ; ' ## .'
     9 3C77 21 25 29 FF FF	    .by $21, $25, $29, $ff, $ff ; '## ..'
    10 3C7C 22 26 2A FF FF	    .by $22, $26, $2a, $ff, $ff ; '## ..'
    11 3C81			dino_run_1
    12 3C81 FF 23 27 2B FF	    .by $ff, $23, $27, $2b, $ff ; '.   .'
    13 3C86 20 24 28 2C FF	    .by $20, $24, $28, $2c, $ff ; ' ## .'
    14 3C8B 21 25 29 FF FF	    .by $21, $25, $29, $ff, $ff ; '## ..'
    15 3C90 2D 2E 2F FF FF	    .by $2d, $2e, $2f, $ff, $ff ; '## ..'
    16 3C95			dino_run_2
    17 3C95 FF 23 27 2B FF	    .by $ff, $23, $27, $2b, $ff ; '.   .'
    18 3C9A 20 24 28 2C FF	    .by $20, $24, $28, $2c, $ff ; ' ## .'
    19 3C9F 21 25 29 FF FF	    .by $21, $25, $29, $ff, $ff ; '## ..'
    20 3CA4 30 31 32 FF FF	    .by $30, $31, $32, $ff, $ff ; '## ..'
    21 3CA9			dino_crouch_1
    22 3CA9 FF FF FF FF FF	    .by $ff, $ff, $ff, $ff, $ff ; '.....'
    23 3CAE FF FF FF FF FF	    .by $ff, $ff, $ff, $ff, $ff ; '.....'
    24 3CB3 33 34 35 36 37	    .by $33, $34, $35, $36, $37 ; '#### '
    25 3CB8 38 39 3A 3B 3C	    .by $38, $39, $3a, $3b, $3c ; '#### '
    26 3CBD			dino_crouch_2
    27 3CBD FF FF FF FF FF	    .by $ff, $ff, $ff, $ff, $ff ; '.....'
    28 3CC2 FF FF FF FF FF	    .by $ff, $ff, $ff, $ff, $ff ; '.....'
    29 3CC7 33 34 35 36 37	    .by $33, $34, $35, $36, $37 ; '#### '
    30 3CCC 3D 3E 3F 3B 3C	    .by $3d, $3e, $3f, $3b, $3c ; '#### '
    31 3CD1			DinoShapesTableL
    32 3CD1 81			    .by <dino_run_1
    33 3CD2 95			    .by <dino_run_2
    34 3CD3 A9			    .by <dino_crouch_1
    35 3CD4 BD			    .by <dino_crouch_2
    36 3CD5 6D			    .by <dino_run_0 ; jump
    37 3CD6 6D			    .by <dino_run_0 ; jump
    38 3CD7			DinoShapesTableH
    39 3CD7 3C			    .by >dino_run_1
    40 3CD8 3C			    .by >dino_run_2
    41 3CD9 3C			    .by >dino_crouch_1
    42 3CDA 3C			    .by >dino_crouch_2
    43 3CDB 3C			    .by >dino_run_0 ; jump
    44 3CDC 3C			    .by >dino_run_0 ; jump
    45 				; other objects
    46 3CDD			ground_0
    47 3CDD FF FF		    .by $ff, $ff    ; '..'
    48 3CDF FF FF		    .by $ff, $ff    ; '..'
    49 3CE1 FF FF		    .by $ff, $ff    ; '..'
    50 3CE3 52 52		    .by $52, $52    ; '##'
    51 3CE5			bird_0
    52 3CE5 FF FF		    .by $ff, $ff    ; '..'
    53 3CE7 FF FF		    .by $ff, $ff    ; '..'
    54 3CE9 40 41		    .by $40, $41    ; '##'
    55 3CEB 52 52		    .by $52, $52    ; '##'
    56 3CED			bird_1
    57 3CED FF FF		    .by $ff, $ff    ; '..'
    58 3CEF 40 41		    .by $40, $41    ; '##'
    59 3CF1 FF FF		    .by $ff, $ff    ; '..'
    60 3CF3 52 52		    .by $52, $52    ; '##'
    61 3CF5			bird_2
    62 3CF5 40 41		    .by $40, $41    ; '##'
    63 3CF7 FF FF		    .by $ff, $ff    ; '..'
    64 3CF9 FF FF		    .by $ff, $ff    ; ''.'
    65 3CFB 52 52		    .by $52, $52    ; '##'
    66 3CFD			bird_0a
    67 3CFD FF FF		    .by $ff, $ff    ; '..'
    68 3CFF FF FF		    .by $ff, $ff    ; '..'
    69 3D01 42 43		    .by $42, $43    ; '##'
    70 3D03 52 52		    .by $52, $52    ; '##'
    71 3D05			bird_1a
    72 3D05 FF FF		    .by $ff, $ff    ; '..'
    73 3D07 42 43		    .by $42, $43    ; '##'
    74 3D09 FF FF		    .by $ff, $ff    ; '..'
    75 3D0B 52 52		    .by $52, $52    ; '##'
    76 3D0D			bird_2a
    77 3D0D 42 43		    .by $42, $43    ; '##'
    78 3D0F FF FF		    .by $ff, $ff    ; '..'
    79 3D11 FF FF		    .by $ff, $ff    ; ''.'
    80 3D13 52 52		    .by $52, $52    ; '##'
    81 3D15			cactus_0
    82 3D15 FF FF		    .by $ff, $ff    ; '..'
    83 3D17 FF FF		    .by $ff, $ff    ; '..'
    84 3D19 46 47		    .by $46, $47    ; '##'
    85 3D1B 44 45		    .by $44, $45    ; '##'
    86 3D1D			cactus_1
    87 3D1D FF FF		    .by $ff, $ff    ; '..'
    88 3D1F FF FF		    .by $ff, $ff    ; '..'
    89 3D21 4A 4B		    .by $4a, $4b    ; '##'
    90 3D23 48 49		    .by $48, $49    ; '##'
    91 3D25			cactus_2
    92 3D25 FF FF		    .by $ff, $ff    ; '..'
    93 3D27 50 51		    .by $50, $51    ; '##'
    94 3D29 4E 4F		    .by $4e, $4f    ; '##'
    95 3D2B 4C 4D		    .by $4c, $4d    ; '##'
    96 3D2D			cactus_3
    97 3D2D FF FF		    .by $ff, $ff    ; '..'
    98 3D2F 57 FF		    .by $57, $ff    ; '#.'
    99 3D31 56 FF		    .by $56, $ff    ; '#.'
   100 3D33 55 52		    .by $55, $52    ; '##'
   101 3D35			cactus_4
   102 3D35 FF FF		    .by $ff, $ff    ; '..'
   103 3D37 FF FF		    .by $ff, $ff    ; '..'
   104 3D39 59 FF		    .by $59, $ff    ; '#.'
   105 3D3B 58 52		    .by $58, $52    ; '##'
   106 3D3D			ground_1
   107 3D3D FF FF		    .by $ff, $ff    ; '..'
   108 3D3F FF FF		    .by $ff, $ff    ; '..'
   109 3D41 FF FF		    .by $ff, $ff    ; '..'
   110 3D43 53 54		    .by $53, $54    ; '##'
   111 3D45			ground_2
   112 3D45 FF FF		    .by $ff, $ff    ; '..'
   113 3D47 FF FF		    .by $ff, $ff    ; '..'
   114 3D49 FF FF		    .by $ff, $ff    ; '..'
   115 3D4B 5A 52		    .by $5a, $52    ; '##'
   116
   117 3D4D			ShapesTableL
   118 3D4D DD			    .by <ground_0
   119 3D4E DD			    .by <ground_0
   120 3D4F E5			    .by <bird_0
   121 3D50 FD			    .by <bird_0a
   122 3D51 ED			    .by <bird_1
   123 3D52 05			    .by <bird_1a
   124 3D53 F5			    .by <bird_2
   125 3D54 0D			    .by <bird_2a
   126 3D55 15			    .by <cactus_0
   127 3D56 1D			    .by <cactus_1
   128 3D57 25			    .by <cactus_2
   129 3D58 2D			    .by <cactus_3
   130 3D59 35			    .by <cactus_4
   131 3D5A 3D			    .by <ground_1
   132 3D5B 45			    .by <ground_2
   133 3D5C			ShapesTableH
   134 3D5C 3C			    .by >ground_0
   135 3D5D 3C			    .by >ground_0
   136 3D5E 3C			    .by >bird_0
   137 3D5F 3C			    .by >bird_0a
   138 3D60 3C			    .by >bird_1
   139 3D61 3D			    .by >bird_1a
   140 3D62 3C			    .by >bird_2
   141 3D63 3D			    .by >bird_2a
   142 3D64 3D			    .by >cactus_0
   143 3D65 3D			    .by >cactus_1
   144 3D66 3D			    .by >cactus_2
   145 3D67 3D			    .by >cactus_3
   146 3D68 3D			    .by >cactus_4
   147 3D69 3D			    .by >ground_1
   148 3D6A 3D			    .by >ground_2
   149 3D6B			diff_object_gap ; min distance between obstacles by difficulty level
   150 3D6B 14 13 12 11 10 0F +     :DIFF_LEVELS .by 20-#
   151 				;----------vars----------
   152 = 3D7B			diff_level  .ds 1
   153 3D7C-3D83> 01 02 03 04 + DinoJumpTr  .by 1,2,3,4,4,3,2,1
   154 = 0008			JumpLen = 8
   155 				.endif  ; .IF *>0
   508 				;--------------------------------------------------
   509
   510 02E0-02E1> 6A 38		    run FirstSTART
